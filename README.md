# ç‹—å¤´å†›å¸ˆ - E2E æµ‹è¯•

> ç‹—å¤´å†›å¸ˆå¾®ä¿¡å°ç¨‹åºè‡ªåŠ¨åŒ–æµ‹è¯•

## æµ‹è¯•æ¦‚è¿°

æœ¬æµ‹è¯•ä½¿ç”¨ `miniprogram-automator` å’Œ `Jest` è¿›è¡Œ E2E è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œç¡®ä¿æ¯ä¸ªæŒ‰é’®è¡Œä¸ºå’Œé¢„æœŸä¸€è‡´ã€‚

## å‰ç½®è¦æ±‚

### 1. å¾®ä¿¡å¼€å‘è€…å·¥å…·é…ç½®

**é‡è¦:** åœ¨è¿è¡Œæµ‹è¯•å‰ï¼Œå¿…é¡»å¼€å¯å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„æœåŠ¡ç«¯å£ï¼š

1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. ç‚¹å‡» **è®¾ç½®** â†’ **å®‰å…¨è®¾ç½®**
3. å¼€å¯ **æœåŠ¡ç«¯å£**
4. ç¡®ä¿å¼€å‘è€…å·¥å…·å¤„äºç™»å½•çŠ¶æ€

### 2. å®‰è£…ä¾èµ–

```bash
cd tests
npm install
```

## è¿è¡Œæµ‹è¯•

### ä¸€é”®è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
npm run test:e2e
```

### è¿è¡Œå•ä¸ªé¡µé¢æµ‹è¯•

```bash
# é¦–é¡µæµ‹è¯•
npm run test:index

# ç»“æœé¡µæµ‹è¯•
npm run test:result

# å†å²è®°å½•é¡µæµ‹è¯•
npm run test:history
```

## æµ‹è¯•è¦†ç›–

### é¦–é¡µ (pages/index)
- [x] é¡µé¢åŠ è½½æˆåŠŸ
- [x] è¾“å…¥é—®é¢˜
- [x] ç‚¹å‡»"ğŸ”® ç”Ÿæˆæ— å˜å¤´å›å¤"æŒ‰é’® â†’ è·³è½¬åˆ°ç»“æœé¡µ
- [x] ç‚¹å‡»"ğŸ’¬ çƒ­é—¨é—®ç­”" â†’ å¡«å……è¾“å…¥æ¡†
- [x] ç‚¹å‡»"ğŸ“œ å†å²è®°å½•" â†’ è·³è½¬åˆ°å†å²é¡µé¢

### ç»“æœé¡µ (pages/result)
- [x] æ˜¾ç¤ºé—®é¢˜å’Œ AI å›å¤
- [x] ç‚¹å‡»"ğŸ“‹ ä¸€é”®å¤åˆ¶" â†’ å¤åˆ¶åˆ°å‰ªè´´æ¿
- [x] ç‚¹å‡»"ğŸ‘ ç‚¹èµ" â†’ ç‚¹èµæ•°+1
- [x] ç‚¹å‡»"ğŸ”„ å†é—®ä¸€ä¸ª" â†’ è¿”å›é¦–é¡µ
- [x] ç‚¹å‡»"â† è¿”å›" â†’ è¿”å›é¦–é¡µ

### å†å²è®°å½•é¡µ (pages/history)
- [x] é¡µé¢åŠ è½½æˆåŠŸ
- [x] ç©ºçŠ¶æ€æ˜¾ç¤ºæ­£ç¡®
- [x] ç‚¹å‡»å†å²é¡¹ â†’ è·³è½¬åˆ°ç»“æœé¡µ

## æµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ e2e/
â”‚   â”œâ”€â”€ index.spec.js      # é¦–é¡µæµ‹è¯•
â”‚   â”œâ”€â”€ result.spec.js      # ç»“æœé¡µæµ‹è¯•
â”‚   â”œâ”€â”€ history.spec.js     # å†å²è®°å½•é¡µæµ‹è¯•
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ constants.js    # æµ‹è¯•å¸¸é‡
â”‚       â””â”€â”€ init.js         # æµ‹è¯•å·¥å…·å‡½æ•°
â”œâ”€â”€ jest.config.js         # Jest é…ç½®
â”œâ”€â”€ setup.js               # æµ‹è¯•åˆå§‹åŒ–
â””â”€â”€ package.json           # ä¾èµ–å’Œè„šæœ¬
```

## æµ‹è¯•å·¥å…·å‡½æ•°

| å‡½æ•° | æè¿° |
|------|------|
| `launchApp()` | å¯åŠ¨å°ç¨‹åº |
| `navigateTo(pagePath)` | è·³è½¬åˆ°é¡µé¢ |
| `tap(element)` | ç‚¹å‡»å…ƒç´  |
| `input(text)` | è¾“å…¥æ–‡æœ¬ |
| `expectText(text)` | æ–­è¨€æ–‡æœ¬å­˜åœ¨ |
| `expectUrl(url)` | æ–­è¨€å½“å‰é¡µé¢ |

## æ•…éšœæ’é™¤

### é—®é¢˜: ç«¯å£æœªå¼€å¯
**é”™è¯¯ä¿¡æ¯:** `Error: MiniProgram CLI not found or port not open`

**è§£å†³æ–¹æ¡ˆ:**
1. ç¡®ä¿å¾®ä¿¡å¼€å‘è€…å·¥å…·å·²å¼€å¯æœåŠ¡ç«¯å£
2. é‡å¯å¾®ä¿¡å¼€å‘è€…å·¥å…·

### é—®é¢˜: æµ‹è¯•è¶…æ—¶
**é”™è¯¯ä¿¡æ¯:** `TimeoutError: Timed out after 30000ms`

**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®ä¿å¾®ä¿¡å¼€å‘è€…å·¥å…·å·²ç™»å½•
3. å°è¯•å¢åŠ è¶…æ—¶æ—¶é—´

## ç›¸å…³é“¾æ¥

- [miniprogram-automator](https://www.npmjs.com/package/miniprogram-automator)
- [Jest](https://jestjs.io/)
- [å¾®ä¿¡å°ç¨‹åºæ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/framework/)
