<!--pages/community/community.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ¨ªå¹…å›¾ -->
  <view class="hero-banner">
    <image class="hero-img" src="/images/banner-community.png" mode="aspectFill" />
    <view class="hero-overlay"></view>
  </view>

  <!-- æ ‡ç­¾æ ï¼ˆç´§è´´æ¨ªå¹…ä¸‹æ–¹ï¼‰ -->
  <view class="tab-header" style="top: {{tabStickyTop}}px;">
    <view class="tab-bar">
      <view
        class="tab-item {{sortBy === 'hot' ? 'active' : ''}}"
        bindtap="switchTab"
        data-sort="hot"
      >
        <text class="tab-icon">ğŸ”¥</text>
        <text>çƒ­åº¦æ’åº</text>
      </view>
      <view
        class="tab-item {{sortBy === 'latest' ? 'active' : ''}}"
        bindtap="switchTab"
        data-sort="latest"
      >
        <text class="tab-icon">ğŸ•</text>
        <text>æœ€æ–°å‘å¸ƒ</text>
      </view>
    </view>
  </view>

  <!-- æ•°æ®åº“é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:if="{{collectionError}}">
    <text class="error-icon-text">âš ï¸</text>
    <text class="error-text">æ•°æ®åº“å¾…åˆå§‹åŒ–</text>
    <text class="error-hint">éœ€è¦åˆå§‹åŒ–ä»¥ä¸‹é›†åˆ: {{collectionNotReady}}</text>
    <button class="retry-btn" bindtap="initDatabase">ç«‹å³åˆå§‹åŒ–</button>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:elif="{{questions.length === 0 && !loading}}">
    <image
      class="empty-image"
      src="/images/empty-community.jpg"
      mode="aspectFill"
    />
    <text class="empty-title">è¿˜æ²¡æœ‰äººæé—®å“¦~</text>
    <text class="empty-subtitle">å¿«å»é¦–é¡µé—®ç‚¹ä»€ä¹ˆå§ï¼</text>
  </view>

  <!-- é—®é¢˜å¡ç‰‡åˆ—è¡¨ -->
  <view class="question-list" wx:else>
    <view
      class="question-card"
      wx:for="{{questions}}"
      wx:key="_id"
      bindtap="handleCardClick"
      data-item="{{item}}"
    >
      <!-- ç”¨æˆ·ä¿¡æ¯è¡Œ -->
      <view class="user-row">
        <text class="user-emoji">ğŸ­</text>
        <text class="user-name">åŒ¿åç”¨æˆ·</text>
        <text class="time-dot">Â·</text>
        <text class="time-text">{{item._relativeTime}}</text>
      </view>

      <!-- é—®é¢˜ -->
      <view class="question-row">
        <text class="question-label">é—®ï¼š</text>
        <text class="question-text">{{item.question}}</text>
      </view>

      <!-- å›ç­”é¢„è§ˆ -->
      <view class="answer-preview" wx:if="{{item.reply}}">
        <text class="answer-text">{{item.reply}}</text>
      </view>

      <!-- ç»Ÿè®¡æ  -->
      <view class="stats-bar">
        <view class="stats-left">
          <view class="stat-item">
            <text class="stat-icon">ğŸ‘ï¸</text>
            <text class="stat-text">{{item._viewsText || '0'}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-icon">ğŸ’¬</text>
            <text class="stat-text">{{item._commentsText || '0'}}</text>
          </view>
        </view>
        <view class="stat-item like-btn {{item._liked ? 'liked' : ''}}" catchtap="handleLike" data-id="{{item._id}}">
          <text class="stat-icon">{{item._liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="stat-text {{item._liked ? 'liked-text' : ''}}">{{item._likesText || '0'}}</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more" wx:if="{{!hasMore && questions.length > 0 && !loading}}">
      <text class="no-more-text">â€” æ²¡æœ‰æ›´å¤šäº† â€”</text>
    </view>
  </view>
</view>
