<!--pages/community/community.wxml-->
<view class="container">
  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <view 
      class="filter-item {{filter === 'latest' ? 'active' : ''}}" 
      bindtap="onFilterTap" 
      data-filter="latest"
    >
      æœ€æ–°
    </view>
    <view 
      class="filter-item {{filter === 'hot' ? 'active' : ''}}" 
      bindtap="onFilterTap" 
      data-filter="hot"
    >
      æœ€çƒ­
    </view>
  </view>

  <!-- é—®é¢˜åˆ—è¡¨ -->
  <view class="question-list">
    <block wx:if="{{questions.length > 0}}">
      <view 
        class="question-card" 
        wx:for="{{questions}}" 
        wx:key="_id"
      >
        <view class="question-header" bindtap="onQuestionTap" data-id="{{item._id}}">
          <text class="question-text">{{item.question}}</text>
          <text class="expand-icon">{{expandedId === item._id ? 'æ”¶èµ·' : 'å±•å¼€'}}</text>
        </view>
        
        <view class="answer-section {{expandedId === item._id ? 'show' : 'hide'}}">
          <text class="answer-text">{{item.reply}}</text>
          
          <view class="vote-bar">
            <view class="vote-item" bindtap="onVote" data-type="question" data-id="{{item._id}}">
              <text class="vote-icon">{{item.voted ? 'â¤ï¸' : 'ğŸ¤'}}</text>
              <text class="vote-count">{{item.likes || 0}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>
    
    <!-- æ•°æ®åº“é›†åˆé”™è¯¯çŠ¶æ€ -->
    <view class="error-state" wx:if="{{collectionError}}">
      <text class="error-icon">âš ï¸</text>
      <text class="error-text">æ•°æ®åº“å¾…åˆå§‹åŒ–</text>
      <text class="error-hint">éœ€è¦åˆå§‹åŒ–ä»¥ä¸‹é›†åˆ: {{collectionNotReady.join(', ')}}</text>
      <view class="error-actions">
        <button class="retry-btn" bindtap="initDatabase">ç«‹å³åˆå§‹åŒ–</button>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{questions.length === 0 && !loading && !collectionError}}">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">æš‚æ— é—®é¢˜ï¼Œå¿«æ¥é¦–é¡µæé—®å§ï¼</text>
    </view>
    
    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more" wx:if="{{!hasMore && questions.length > 0 && !loading}}">
      <text>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
  </view>
</view>
